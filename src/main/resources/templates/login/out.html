<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <th:block th:replace="~{_fragments/_head :: my-head('회원 탈퇴')}" />
  <link rel="stylesheet" th:href="@{/assets/css/account.css}">
  <style></style>
</head>
<body>

  <div class="account-container">
        <h2 class="page-title"> 회원탈퇴 </h2>

        <form  id="delete-account-form">

            <div class="input-container">
                <input type="password" name="password" id="user_pw" class="input-field" placeholder="비밀번호" />
            </div>

            <button type="submit" class="btn">회원탈퇴</button>
        </form>

        <div class="form-footer">
            <p> 계정을 유지하고 싶으신가요? <a th:href="@{/account}">돌아가기</a></p>

        </div>
  </div>


  <!-- 스크립트 -->
<th:block th:replace="~{_fragments/_scripts :: my-scripts}"></th:block>
<script>
   document.querySelector("#delete-account-form").addEventListener('submit',async (e)=>{

    e.preventDefault();
    const current=e.currentTarget;

  try{
    regexHelper.value("#user_pw","비밀번호 입력하세여");
  } catch(err){

       await utilHelper.alertDanger(err.message);
       setTimeout(()=>err.element.focus(),300);
       return;
 }

 const resuslt=await utilHelper.confirmWarning("탈퇴확인","정말탈퇴하시겠습니까? 탈퇴 후에는 복구할수 없습니다")

     if(resuslt.value){
     try{
        await fetchHelper.delete('[[@{/api/account/out}]]' ,new FormData(current));
      } catch(e){
        await utilHelper.alertDanger(e.message);
        console.error(e);
           return;
      }

      await utilHelper.alertSuccess("탈퇴가 완료되었습니다.")
    window.location="[[@{/account}]]";
     }
   })
</script>


</body>
</html>
