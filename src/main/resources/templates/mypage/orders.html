<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/assets/css/mypage.css}"/>
    <title>마이페이지</title>
    <style>

        .review{
          display: inline-block;
          background-color: #b20000;
          margin-top:5px;
          color: white;
          font-weight: bold;
          padding: 8px 10px;
          border-radius: 6px;
          text-decoration: none;
          box-shadow: 0 3px 6px rgba(0,0,0,0.2);
          transition: background-color 0.3s ease, transform 0.2s ease;
          font-size: 12px;}


        .review:hover {
          background-color: #e64a19;
          transform: translateY(-2px);
          box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        .btn-confirm {
        display: inline-block;
        background-color: #b20000;
        margin-top: 5px;
        color: white;
        font-weight: bold;
        padding: 8px 10px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        transition: background-color 0.3s ease, transform 0.2s ease;
        font-size: 12px;
        }

        .btn-confirm:hover {
        background-color: #e64a19;
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

    </style>
</head>
<body>

<header th:replace="fragments/header :: my-header"></header>

<main>
    <aside>
        <h2>마이페이지</h2>

        <h3>쇼핑정보</h3>
        <ul>
            <li><a th:href="@{/mypage/orders}">주문목록/배송조회</a></li>
            <li><a th:href="@{/mypage/returns}">취소/반품/교환 내역</a></li>
            <li><a th:href="@{/mypage/refund}">환불/입금 내역</a></li>
            <li><a th:href="@{/mypage/wishlist}">위시리스트</a></li>
        </ul>

        <hr/>

        <h3>고객센터</h3>
        <ul>
            <li><a th:href="@{/mypage/inquiry}">1:1 문의</a></li>
        </ul>

        <hr/>

        <h3>회원정보</h3>
        <ul>
            <li><a th:href="@{/mypage/member-edit}">회원정보 변경</a></li>
            <li><a th:href="@{/mypage/withdraw}">회원 탈퇴</a></li>
        </ul>

        <hr/>

        <h3>나의 상품문의</h3>
        <ul>
            <li><a th:href="@{/mypage/product-inquiries}">나의 상품문의</a></li>
        </ul>

        <hr/>

        <h3>나의 상품후기</h3>
        <ul>
            <li><a th:href="@{/reviews/mine}">나의 상품후기</a></li>
        </ul>
    </aside>

    <div class="content-wrapper">
        <section class="order-list">
            <h2>주문목록/배송조회</h2>
            <hr class="order-title-line">

            <form id="orderSearchForm" th:action="@{/orders}" method="get">
                <div class="order-filter-inline">
                    <div class="radio-buttons">
                        <label><input type="radio" name="period" value="0" th:checked="${period == 0}"/>오늘</label>
                        <label><input type="radio" name="period" value="7" th:checked="${period == 7}"/> 7일</label>
                        <label><input type="radio" name="period" value="15" th:checked="${period == 15}"/> 15일</label>
                        <label><input type="radio" name="period" value="30" th:checked="${period == 30}"/> 1개월</label>
                        <label><input type="radio" name="period" value="90" th:checked="${period == 90}"/> 3개월</label>
                        <label><input type="radio" name="period" value="365" th:checked="${period == 365}"/> 1년</label>
                    </div>

                    <div class="date-search-group">
                        <input type="date" name="startDate" th:value="${startDate}"/>
                        <span>~</span>
                        <input type="date" name="endDate"  th:value="${endDate}"/>
                        <button type="submit" class="btn-search">조회</button>
                    </div>
                </div>
            </form>

            <p class="order-count">
                주문목록 / 배송조회 내역 총 <span th:text="${orderCount}">0</span>건
            </p>
            <hr class="top-line">

            <table class="order-table">
                <thead>
                <tr>
                    <th>날짜/주문번호</th>
                    <th>상품명/옵션</th>
                    <th>상품금액/수량</th>
                    <th>주문상태</th>
                    <th>확인/리뷰</th>
                </tr>
                </thead>
                <tbody>
                <!-- 주문 내역이 없을 때 -->
                <tr th:if="${#lists.isEmpty(orderList)}">
                    <td colspan="5" class="no-data">조회내역이 없습니다.</td>
                </tr>

                <!-- 주문 내역이 있을 때 -->
                <tr th:each="item : ${orderList}">
                    <td>
                        <span th:text="${#temporals.format(item.regDate, 'yyyy-MM-dd')}">2025-07-03</span><br/>
                        주문번호: <span th:text="${item.orderItemId}">12345</span>
                    </td>
                    <td>
                        <img th:src="@{${item.orderImg}}" alt="상품 이미지" style="width: 60px;" /><br/>
                        <span th:text="${item.orderPname}">상품명</span>
                    </td>
                    <td>
                        <span th:text="${#numbers.formatInteger(item.orderPrice, 3, 'COMMA')}">12,000</span>원<br/>
                        <span th:text="${item.orderCount}">1</span>개
                    </td>
                    <td>배송 준비중</td>
                    <td>
                        <button type="button" class="btn-check" onclick="location.href='/mypage/my-page'">배송조회</button>
                        <form th:action="@{/mypage/returns}" method="post" style="display:inline;">
                            <input type="hidden" name="orderItemId" th:value="${item.orderItemId}" />
                            <button type="submit" class="btn-return">취소반품</button>
                        </form>
                        <span th:if="${item.reviewed}" style="color:grey">작성완료</span>
                        <a th:if="${!item.reviewed}" 
                        th:href="@{/mypage/orders/review-and-confirm(orderItemId=${item.orderItemId}, productId=${item.productId}, orderPname=${item.orderPname})}" 
                        class="review">리뷰 쓰기</a>
                        <span th:if="${item.orderStatus == '배송완료' or item.orderStatus == '구매확정'}" style="color:grey">확정완료</span>

                        <form th:if="${item.orderStatus != '배송완료' and item.orderStatus != '구매확정'}"
                            th:action="@{/mypage/orders/confirm}" method="post" style="display:inline;">
                            <input type="hidden" name="orderItemId" th:value="${item.orderItemId}" />
                            <button type="submit" class="btn-confirm">주문확정</button>
                        </form>




                    </td>
                </tr>
                </tbody>
            </table>
        </section>
    </div>
</main>

<div th:replace="~{fragments/footer :: my-footer}"></div>
<script th:src="@{/assets/js/logout.js}"></script>

</body>
</html>